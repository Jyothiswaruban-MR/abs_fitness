<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Login | ABS Fitness</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="css/login.css">
</head>
<body>

  <div class="login-container">
    <h2>Welcome Back</h2>
    <p class="subtitle">Login to your fitness dashboard</p>

    <form id="loginForm">
      <!-- Email Field -->
      <div class="form-group">
        <input type="email" id="email" placeholder="Email" required autofocus>
        <div id="emailError" class="error-msg">Please enter a valid email.</div>
      </div>

      <!-- Password Field with Eye Icon -->
      <div class="form-group">
        <div class="password-wrapper">
          <input type="password" id="password" placeholder="Password" required>
          <span id="togglePassword" class="toggle-password">üëÅÔ∏è</span>
        </div>
        <div id="passwordError" class="error-msg">Password is required.</div>
      </div>

      <!-- Forgot Password -->
      <div class="forgot-link">
        <a href="forgotpassword.html">Forgot Password?</a>
      </div>

      <!-- Login Button -->
      <button type="submit">Login</button>

      <!-- General Login Error -->
      <div id="loginError" class="error-msg"></div>
    </form>

    <!-- Sign Up Link -->
    <p class="footer-link">
      Don't have an account?
      <a href="register.html">Sign Up</a>
    </p>
  </div>

  <script>
    const loginForm = document.getElementById("loginForm");
    const emailInput = document.getElementById("email");
    const passwordInput = document.getElementById("password");
    const togglePassword = document.getElementById("togglePassword");

    const emailError = document.getElementById("emailError");
    const passwordError = document.getElementById("passwordError");
    const loginError = document.getElementById("loginError");

    togglePassword.addEventListener("click", () => {
      const type = passwordInput.type === "password" ? "text" : "password";
      passwordInput.type = type;
      togglePassword.textContent = type === "password" ? "üëÅÔ∏è" : "üôà";
    });

    loginForm.addEventListener("submit", async function (e) {
      e.preventDefault();
      emailError.style.display = "none";
      passwordError.style.display = "none";
      loginError.style.display = "none";

      const email = emailInput.value.trim();
      const password = passwordInput.value.trim();

      let hasError = false;

      if (!email || !email.includes("@")) {
        emailError.style.display = "block";
        hasError = true;
      }
      if (!password) {
        passwordError.style.display = "block";
        hasError = true;
      }

      if (hasError) return;

      try {
        const res = await fetch("http://localhost:5000/auth/login", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email, password }),
        });

        const data = await res.json();

        if (res.ok && data.token) {
          localStorage.setItem("token", data.token);
          window.location.href = "dashboard.html";
        } else {
          loginError.textContent = data.message || "Login failed.";
          loginError.style.display = "block";
        }
      } catch (err) {
        loginError.textContent = "Server error. Try again later.";
        loginError.style.display = "block";
      }
    });
  </script>

</body>
</html>
